---
tags:
  - kernel
  - CS
---
# What is kernel queue?
Kernel event queue = KQ

- KQ는 서버 소프트웨어가 매우 효과적인 방식으로 OS의 이벤트를 처리할 수 있도록 하는 빠른 신호 전달 메커니즘

- KQ는 커널 메모리에 존재하는 일련의 데이터와 이 데이터를 조작하여 다양한 시스템 이벤트에 대해 사용자 수준의 애플리케이션에 알림을 제공하는 일련의 커널 코드로 구성되어 있다.

- 사용자 앱은 KQ 데이터에 직접 액세스할 수 없으므로(커널에 의해 관리됨) OS가 제공하는 API를 통해 KQ와 함께 작동한다. (kqueue, epoll...)

- KQ의 주요 목적은 네트워크 소켓에서 알림을 전달하는 것

## use-case N1
- 애플리케이션이 KQ 기술을 통해 얻을 수 있는 것은 네트워크 패킷이 수신될 때와 같은 I/O 신호에 대해 알림을 받는 것이다.

0. 어떤 사용자 앱이 UDP 소켓을 생성하고 앱 정의 데이터(예: 쿠키)와 함께 KQ에 등록했다고 가정해 보겠습니다.
1. 어느 시점에 네트워크 디바이스에서 UDP 패킷의 마지막 청크를 수신합니다.
2. 이제 OS는 완전한 UDP 패킷을 확보하고 KQ 대기 함수를 호출하는 즉시 사용자 프로세스에 알릴 준비가 되었습니다.
3. 어느 시점에 사용자 앱은 커널에 이를 알리는 KQ 대기 함수를 호출합니다: 새로운 것을 주세요.
4. OS는 쿠키와 연결된 소켓에서 Got a READ 이벤트로 응답합니다.
5. 이 쿠키는 앱이 신호를 처리하는 데 사용하는 객체 포인터로, 이 경우 UDP 소켓에서 메시지를 읽습니다.
